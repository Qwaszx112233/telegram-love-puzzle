<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>üíñ Love Number Puzzle - –î–ª—è –º–æ—î—ó –∫–æ—Ö–∞–Ω–æ—ó üíñ</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
  <style>
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏ */
    .romantic-particle {
      position: fixed;
      pointer-events: none;
      font-size: 1.5rem;
      z-index: 1000;
      animation: romanticFloat 3s ease-in-out forwards;
    }
    
    @keyframes romanticFloat {
      0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
      100% { transform: translateY(-100px) rotate(360deg) scale(0.5); opacity: 0; }
    }
    
    .romantic-subtitle {
      font-size: 1.2rem;
      color: #e91e63;
      margin-bottom: 2rem;
      text-align: center;
      font-weight: bold;
    }
    
    .swipe-hint {
      text-align: center;
      color: #e91e63;
      font-weight: bold;
      margin: 10px 0;
      font-size: 0.9rem;
    }
    
    .touch-glow {
      position: fixed;
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, rgba(255,107,107,0.6) 0%, rgba(255,107,107,0) 70%);
      border-radius: 50%;
      pointer-events: none;
      z-index: 999;
      animation: touchPulse 0.6s ease-out forwards;
      transform: translate(-50%, -50%);
    }
    
    @keyframes touchPulse {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
    }
    
    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∏ */
    body {
      background: linear-gradient(135deg, #ffafbd 0%, #ffc3a0 100%) !important;
      font-family: 'Arial', sans-serif;
    }
    
    .game-title {
      background: linear-gradient(45deg, #e91e63, #ff4081);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    .cell {
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(233, 30, 99, 0.2);
    }
    
    .cell.selected {
      transform: scale(0.9);
      box-shadow: 0 0 15px rgba(255, 64, 129, 0.6);
      z-index: 10;
    }
  </style>
</head>
<body>
  <!-- Enhanced Floating Hearts Background -->
  <div class="floating-hearts" id="floatingHearts"></div>
  
  <!-- Romantic Particles Container -->
  <div id="romanticParticles"></div>
  
  <!-- Victory Overlay -->
  <div class="victory-overlay hidden" id="victoryOverlay">
    <div class="victory-content">
      <div class="victory-title">üíù –ú–æ—è –ª—é–±–æ–≤! üíù</div>
      <div class="victory-message" id="victoryMessage">–¢–∏ –ø—Ä–æ–π—à–ª–∞ –≤—Å—ñ —Ä—ñ–≤–Ω—ñ! –¢–∏ –Ω–∞–π–∫—Ä–∞—â–∞ –¥—Ä—É–∂–∏–Ω–∞ —É —Å–≤—ñ—Ç—ñ! üíñ</div>
      <div class="menu-buttons">
        <button class="menu-btn" id="playAgainBtn">üíï –ì—Ä–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
        <button class="menu-btn secondary" id="closeWebAppBtn">üòò –ü–æ—Ü—ñ–ª—É–Ω–æ–∫</button>
      </div>
    </div>
  </div>
  
  <!-- Main Menu Screen -->
  <div class="screen" id="mainMenuScreen">
    <div class="game-title">üíñ Love Puzzle üíñ</div>
    <div class="romantic-subtitle">–î–ª—è –º–æ—î—ó –Ω–∞–π–∫—Ä–∞—â–æ—ó –¥—Ä—É–∂–∏–Ω–∏</div>
    <div class="menu-buttons">
      <button class="menu-btn" id="playBtn">üéÆ –ü–æ—á–∞—Ç–∏ –≥—Ä—É –∫–æ—Ö–∞–Ω–Ω—è</button>
      <button class="menu-btn secondary" id="settingsBtn">üíù –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
      <button class="menu-btn secondary" id="aboutBtn">üåπ –ü—Ä–æ –Ω–∞—à–µ –∫–æ—Ö–∞–Ω–Ω—è</button>
    </div>
    <div class="menu-features">
      <div class="feature-item">üíñ –Ø —Ç–µ–±–µ</div>
      <div class="feature-item">–∫–æ—Ö–∞—é</div>
      <div class="feature-item">–±—ñ–ª—å—à–µ</div>
      <div class="feature-item">–∑–∞ –≤—Å–µ üíñ</div>
    </div>
  </div>
  
  <!-- Game Screen -->
  <div class="screen game-screen hidden" id="gameScreen">
    <div class="game-header">
      <div class="header-top">
        <button class="home-btn" id="homeBtn">üè† –î–æ–¥–æ–º—É</button>
        <div class="header">–ú–æ—è –ª—é–±–æ–≤, —è —Ç–µ–±–µ –æ–±–æ–∂–Ω—é—é! üíï</div>
      </div>
      <div class="love-message">
        <div class="hearts" id="hearts"></div>
        <div class="message-text" id="messageText">–ü—Ä–æ–≤–µ–¥–∏ –ø–∞–ª—å—á–∏–∫–æ–º –ø–æ —á–∏—Å–ª–∞—Ö —Ç–∞ –æ—Ç—Ä–∏–º—É–π –ª—é–±–æ–≤–Ω—ñ —Ñ—Ä–∞–∑–∏! üå∏</div>
      </div>
      <div class="stats">
        <div class="stat-item">–†—ñ–≤–µ–Ω—å: <span id="currentLevel">1</span>/30</div>
        <div class="stat-item">–¶—ñ–ª—å: <span id="targetValue">64</span></div>
        <div class="stat-item">–§—Ä–∞–∑: <span id="messageCount">0</span></div>
      </div>
    </div>
    
    <div class="xp-bar">
      <div class="xp-bar-inner" id="xpBar">
        <div class="xp-bar-text" id="xpText">0/10</div>
      </div>
    </div>
    
    <div class="game-content">
      <div class="bonuses">
        <button class="bonus-btn" id="bonus-destroy">
          üíñ –†–æ–∑–±–∏—Ç–∏ <span class="bonus-cost">5</span>
        </button>
        <button class="bonus-btn" id="bonus-shuffle">
          üîÑ –ü–µ—Ä–µ–º—ñ—à–∞—Ç–∏ <span class="bonus-cost">10</span>
        </button>
        <button class="bonus-btn" id="bonus-explosion">
          üí• –í–∏–±—É—Ö –∫–æ—Ö–∞–Ω–Ω—è <span class="bonus-cost">20</span>
        </button>
      </div>
      
      <div class="level-select" id="level-select"></div>
      
      <div class="swipe-hint">üëÜ –ü—Ä–æ–≤–µ–¥–∏ –ø–∞–ª—å—Ü–µ–º –ø–æ —á–∏—Å–ª–∞—Ö –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ª–∞–Ω—Ü—é–∂–∫–∞</div>
      
      <div class="grid-container">
        <div class="grid" id="grid"></div>
      </div>
      
      <div class="controls">
        <button class="btn back-btn" id="backBtn">‚Üê –î–æ –∫–æ—Ö–∞–Ω–æ—ó</button>
        <button class="btn" id="resetBtn">üîÑ –ü–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
        <button class="btn" id="nextLevelBtn">‚≠ê –î–∞–ª—ñ –¥–æ —â–∞—Å—Ç—è</button>
      </div>
    </div>
  </div>

  <!-- Settings Screen -->
  <div class="screen settings-screen hidden" id="settingsScreen">
    <div class="settings-title">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚öôÔ∏è</div>
    <div class="settings-options">
      <div class="setting-item">
        <label class="setting-label">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:</label>
        <select class="setting-control" id="difficultySelect">
          <option value="easy">–õ–µ–≥–∫–∞</option>
          <option value="medium" selected>–°–µ—Ä–µ–¥–Ω—è</option>
          <option value="hard">–°–∫–ª–∞–¥–Ω–∞</option>
        </select>
      </div>
      <div class="setting-item">
        <label class="setting-label">–ó–≤—É–∫–∏:</label>
        <select class="setting-control" id="soundSelect">
          <option value="on" selected>–£–≤—ñ–º–∫–Ω–µ–Ω–æ</option>
          <option value="off">–í–∏–º–∫–Ω–µ–Ω–æ</option>
        </select>
      </div>
      <div class="setting-item">
        <label class="setting-label">–ê–Ω—ñ–º–∞—Ü—ñ—ó:</label>
        <select class="setting-control" id="animationSelect">
          <option value="on" selected>–£–≤—ñ–º–∫–Ω–µ–Ω–æ</option>
          <option value="off">–í–∏–º–∫–Ω–µ–Ω–æ</option>
        </select>
      </div>
    </div>
    <div class="menu-buttons" style="margin-top: 20px;">
      <button class="menu-btn" id="saveSettingsBtn">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <button class="menu-btn secondary" id="backFromSettingsBtn">‚Üê –ù–∞–∑–∞–¥</button>
    </div>
  </div>
  
  <!-- About Screen -->
  <div class="screen settings-screen hidden" id="aboutScreen">
    <div class="settings-title">–ü—Ä–æ –Ω–∞—à–µ –∫–æ—Ö–∞–Ω–Ω—è üåπ</div>
    <div class="settings-options">
      <div class="setting-item" style="text-align: center;">
        <h3 style="font-size: clamp(1.1rem, 4vw, 1.3rem); margin-bottom: 10px;">Love Number Puzzle</h3>
        <p style="margin: 8px 0; line-height: 1.3; font-size: clamp(0.8rem, 3vw, 0.9rem);">
          –¶—è –≥—Ä–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –∑ –ª—é–±–æ–≤'—é –¥–ª—è –º–æ—î—ó –Ω–∞–π–∫—Ä–∞—â–æ—ó –¥—Ä—É–∂–∏–Ω–∏! üíï<br>
          –ö–æ–∂–Ω–∞ —Ñ—Ä–∞–∑–∞ - —Ü–µ —á–∞—Å—Ç–∏–Ω–∫–∞ –º–æ–≥–æ —Å–µ—Ä—Ü—è, –∫–æ–∂–Ω–µ —á–∏—Å–ª–æ - —Ü–µ –∫—Ä–æ–∫ –¥–æ –Ω–∞—à–æ–≥–æ —â–∞—Å—Ç—è.
        </p>
        <p style="margin: 8px 0; line-height: 1.3; font-size: clamp(0.8rem, 3vw, 0.9rem);">
          üåü –ö–æ–∂–µ–Ω —Ä—ñ–≤–µ–Ω—å - —Ü–µ –Ω–æ–≤–µ –≤–∏–∑–Ω–∞–Ω–Ω—è –≤ –∫–æ—Ö–∞–Ω–Ω—ñ:<br>
          ‚Ä¢ 30 —Ä—ñ–≤–Ω—ñ–≤ = 30 –ø—Ä–∏—á–∏–Ω —Ç–µ–±–µ –∫–æ—Ö–∞—Ç–∏<br>
          ‚Ä¢ 40+ –ª—é–±–æ–≤–Ω–∏—Ö —Ñ—Ä–∞–∑ –∑ –º–æ–≥–æ —Å–µ—Ä—Ü—è<br>
          ‚Ä¢ –ë–µ–∑–º–µ–∂–Ω–∞ –ª—é–±–æ–≤ —É –∫–æ–∂–Ω–æ–º—É –¥–æ—Ç–∏–∫—É<br>
        </p>
        <p style="margin: 8px 0; line-height: 1.3; font-size: clamp(0.8rem, 3vw, 0.9rem);">
          –¢–∏ - –º–æ—î —â–∞—Å—Ç—è, –º–æ—è –ª—é–±–æ–≤, –º–æ—î –≤—Å–µ! üíñ<br>
          –ù–∞–∑–∞–≤–∂–¥–∏ —Ç–≤—ñ–π...
        </p>
      </div>
    </div>
    <div class="menu-buttons" style="margin-top: 20px;">
      <button class="menu-btn secondary" id="backFromAboutBtn">‚Üê –ù–∞–∑–∞–¥</button>
    </div>
  </div>

  <script>
    // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –∏–≥—Ä—ã
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing game...');
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
      let tg = null;
      let isTelegram = false;
      
      try {
        if (window.Telegram && window.Telegram.WebApp) {
          tg = window.Telegram.WebApp;
          tg.expand();
          tg.enableClosingConfirmation();
          isTelegram = true;
          console.log('Telegram Web App initialized');
        }
      } catch (error) {
        console.log('Telegram Web App not available:', error);
      }
      
      // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∏–≥—Ä—ã
      class LoveNumberPuzzle {
        constructor() {
          console.log('Initializing LoveNumberPuzzle...');
          
          this.levels = this.generateLevels(30);
          this.MAX_LEVEL = this.levels.length;
          
          // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ª—é–±–æ–≤–Ω—ã—Ö —Ñ—Ä–∞–∑
          this.loveMessages = [
            "–¢–∏ - –º–æ—î —Å–æ–Ω–µ—á–∫–æ, —â–æ –æ—Å–≤—ñ—Ç–ª—é—î –∫–æ–∂–µ–Ω –º—ñ–π –¥–µ–Ω—å üåû",
            "–ö–æ—Ö–∞–Ω–Ω—è –¥–æ —Ç–µ–±–µ –∑ –∫–æ–∂–Ω–∏–º –¥–Ω–µ–º —Å—Ç–∞—î —Å–∏–ª—å–Ω—ñ—à–∏–º üíñ",
            "–¢–≤–æ—ó –æ—á—ñ - —Ü–µ –∑—ñ—Ä–∫–∏, —â–æ –≤–∫–∞–∑—É—é—Ç—å –º–µ–Ω—ñ —à–ª—è—Ö ‚ú®",
            "–ó —Ç–æ–±–æ—é –∫–æ–∂–Ω–∞ –º–∏—Ç—å - —Ü–µ –∫–∞–∑–∫–∞ üè∞",
            "–¢–∏ - –Ω–∞–π–Ω—ñ–∂–Ω—ñ—à–∞ –º—Ä—ñ—è –º–æ—î—ó –¥—É—à—ñ üí≠",
            "–¢–≤–æ—ó –æ–±—ñ–π–º–∏ - –º—ñ–π —É–ª—é–±–ª–µ–Ω–∏–π –∑–∞—Ö–∏—Å—Ç ü§ó",
            "–ö–æ–∂–Ω–∞ —á–∞—Å—Ç–∏–Ω–∫–∞ —Ç–µ–±–µ —á–∞—Ä—ñ–≤–Ω–∞ ü™Ñ",
            "–¢–∏ —Ä–æ–±–∏—à –º–æ—î –∂–∏—Ç—Ç—è —Å–æ–ª–æ–¥—à–∏–º üçØ",
            "–¢–∏ - –º–æ—è —É–ª—é–±–ª–µ–Ω–∞ –ø–∞–Ω–¥–∞ —Å–µ—Ä–µ–¥ —É—Å—ñ—Ö –ø–∞–Ω–¥ üêº",
            "–õ—é–±–ª—é —Ç–µ–±–µ —Å–∏–ª—å–Ω—ñ—à–µ, –Ω—ñ–∂ –∫–æ—Ç–∏ –ª—é–±–ª—è—Ç—å –∫–æ—Ä–æ–±–∫–∏ üì¶",
            "–¢–∏ - –º–æ—î —â–∞—Å—Ç—è, —è–∫ –º–æ—Ä–æ–∑–∏–≤–æ –≤ —Å–ø–µ–∫–æ—Ç–Ω–∏–π –¥–µ–Ω—å üç¶",
            "–¢–≤–æ—è –ø–æ—Å–º—ñ—à–∫–∞ - –Ω–∞–π–∫—Ä–∞—Å–∏–≤—ñ—à–∏–π –ø–µ–π–∑–∞–∂ üòä",
            "–õ—é–±–æ–≤ –¥–æ —Ç–µ–±–µ - –≤—ñ—á–Ω–∞ —ñ –±–µ–∑–º–µ–∂–Ω–∞ ‚ôæÔ∏è",
            "–¢–∏ - –º—ñ–π —Å–ø–æ–∫—ñ–π —Å–µ—Ä–µ–¥ –±—É—Ä—ñ üåä",
            "–ó —Ç–æ–±–æ—é —è –∑–Ω–∞–π—à–æ–≤ —Å–ø—Ä–∞–≤–∂–Ω—î —â–∞—Å—Ç—è ü•π",
            "–¢–≤–æ—î —Å–µ—Ä—Ü–µ - –º—ñ–π –Ω–∞–π—Ü—ñ–Ω–Ω—ñ—à–∏–π —Å–∫–∞—Ä–± üíé",
            "–ö–æ–∂–Ω–∞ –º–∏—Ç—å –∑ —Ç–æ–±–æ—é - —Ü–µ –ø–æ–¥–∞—Ä—É–Ω–æ–∫ üéÅ",
            "–¢–∏ —Ä–æ–±–∏—à –º–æ—î –∂–∏—Ç—Ç—è —è—Å–∫—Ä–∞–≤—ñ—à–∏–º üåà",
            "–ú–æ—î –∫–æ—Ö–∞–Ω–Ω—è –¥–æ —Ç–µ–±–µ –±–µ–∑–º–µ–∂–Ω–µ, —è–∫ –æ–∫–µ–∞–Ω üåä",
            "–¢–∏ - –ø—Ä–∏—á–∏–Ω–∞ –º–æ—î—ó –ø–æ—Å–º—ñ—à–∫–∏ –∫–æ–∂–Ω–æ–≥–æ –¥–Ω—è üòä",
            "–¢–≤–æ—è –ª—é–±–æ–≤ - –Ω–∞–π–∫—Ä–∞—â–µ, —â–æ —Å—Ç–∞–ª–æ—Å—è –≤ –º–æ—î–º—É –∂–∏—Ç—Ç—ñ üíù",
            "–ó —Ç–æ–±–æ—é —è –º–æ–∂—É –¥–æ—Å—è–≥—Ç–∏ –±—É–¥—å-—á–æ–≥–æ! üöÄ",
            "–¢–∏ - –º–æ—è –º—É–∑–∞ —Ç–∞ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è üé®",
            "–ö–æ–∂–µ–Ω –¥–µ–Ω—å –∑ —Ç–æ–±–æ—é - —Ü–µ –Ω–æ–≤–∞ –ø—Ä–∏–≥–æ–¥–∞ üó∫Ô∏è",
            "–¢–≤–æ—è –ø—Ä–∏—Å—É—Ç–Ω—ñ—Å—Ç—å —Ä–æ–±–∏—Ç—å –≤—Å–µ –∫—Ä–∞—â–∏–º ‚ú®",
            "–¢–∏ - –º–æ—è —Ç–∏—Ö–∞ –≥–∞–≤–∞–Ω—å —É –±—É—Ä—Ö–ª–∏–≤–æ–º—É –º–æ—Ä—ñ ‚öì",
            "–õ—é–±–ª—é —Ç–µ–±–µ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ —Å–ª–æ–≤–∞ –º–æ–∂—É—Ç—å –ø–µ—Ä–µ–¥–∞—Ç–∏ üíå",
            "–¢–∏ - –º—ñ–π —â–∞—Å–ª–∏–≤–∏–π –∫–≤–∏—Ç–æ–∫ —É –∂–∏—Ç—Ç—ñ üé´",
            "–ó —Ç–æ–±–æ—é –∫–æ–∂–µ–Ω –¥–µ–Ω—å - —Å–≤—è—Ç–æ üéâ",
            "–¢–∏ - –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –≤—Å—ñ –º–æ—ó –º–æ–ª–∏—Ç–≤–∏ üôè",
            "–ú–æ—î —Å–µ—Ä—Ü–µ –Ω–∞–ª–µ–∂–∏—Ç—å —Ç–æ–±—ñ –Ω–∞–∑–∞–≤–∂–¥–∏ üíò",
            "–¢–∏ - –º–æ—è –¥—Ä—É–≥–∞ –ø–æ–ª–æ–≤–∏–Ω–∫–∞, —è–∫—É —è —à—É–∫–∞–≤ –≤—Å–µ –∂–∏—Ç—Ç—è üíë",
            "–ö–æ–∂–Ω–∞ –∫–ª—ñ—Ç–∏–Ω–∫–∞ –º–æ–≥–æ —Ç—ñ–ª–∞ –ª—é–±–∏—Ç—å —Ç–µ–±–µ üî¨",
            "–¢–∏ - –º–æ—è –º—Ä—ñ—è, —è–∫–∞ –∑–±—É–ª–∞—Å—è üå†",
            "–õ—é–±–ª—é —Ç–µ–±–µ –¥–æ –º—ñ—Å—è—Ü—è —ñ –Ω–∞–∑–∞–¥ üåô",
            "–¢–≤–æ—è –ª—é–±–æ–≤ - –º–æ—è –Ω–∞–π–±—ñ–ª—å—à–∞ —Å–∏–ª–∞ üí™",
            "–¢–∏ —Ä–æ–±–∏—à –º–æ—î –∂–∏—Ç—Ç—è —Å–ø—Ä–∞–≤–¥—ñ –∑–Ω–∞—á—É—â–∏–º üéØ",
            "–ú–æ—î –∫–æ—Ö–∞–Ω–Ω—è –¥–æ —Ç–µ–±–µ –±–µ–∑ —É–º–æ–≤ —ñ –∫–æ—Ä–¥–æ–Ω—ñ–≤ üíû",
            "–¢–∏ - –Ω–∞–π–∫—Ä–∞—â–∞ –¥—Ä—É–∂–∏–Ω–∞ —É –≤—Å—ñ–π –í—Å–µ—Å–≤—ñ—Ç—ñ üåå",
            "–õ—é–±–ª—é —Ç–µ–±–µ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ –≤—á–æ—Ä–∞, –∞–ª–µ –º–µ–Ω—à–µ, –Ω—ñ–∂ –∑–∞–≤—Ç—Ä–∞ üìÖ",
            "–¢–∏ - –º–æ—î –≤—Å–µ, –º–æ—è –ª—é–±–æ–≤, –º–æ—î –∂–∏—Ç—Ç—è üíñ",
            "–ó —Ç–æ–±–æ—é –∫–æ–∂–µ–Ω –¥–µ–Ω—å - —Ü–µ –Ω–æ–≤–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∫–æ—Ö–∞–Ω–Ω—è üîç",
            "–¢–≤–æ—è –ª—é–±–æ–≤ - —Ü–µ –º—É–∑–∏–∫–∞ –º–æ–≥–æ —Å–µ—Ä—Ü—è üéµ",
            "–¢–∏ - –Ω–∞–π–∫—Ä–∞—Å–∏–≤—ñ—à–∞ –∫–∞–∑–∫–∞ –º–æ–≥–æ –∂–∏—Ç—Ç—è üìñ",
            "–ú–æ—î –∫–æ—Ö–∞–Ω–Ω—è –¥–æ —Ç–µ–±–µ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–≥–∞—Å–Ω–µ üî•"
          ];
          
          this.GRID_W = 5;
          this.GRID_H = 8;
          this.bonusCosts = { destroy: 5, shuffle: 10, explosion: 20 };
          
          this.currentLevel = 0;
          this.grid = [];
          this.selected = [];
          this.isDragging = false;
          this.chainNumbers = [];
          this.xp = 0;
          this.xpToNext = 10;
          this.maxNumber = 8;
          this.activeBonus = null;
          this.gameState = 'playing';
          this.messageCount = 0;
          
          this.lastTouchPos = null;
          
          this.createEnhancedFloatingHearts();
          this.initializeEventListeners();
          this.showScreen('mainMenu');
          
          console.log('Game initialized successfully');
        }
        
        createEnhancedFloatingHearts() {
          const container = document.getElementById('floatingHearts');
          if (!container) return;
          
          const heartCount = 20;
          container.innerHTML = '';
          
          const heartTypes = ['‚ù§Ô∏è', 'üíñ', 'üíï', 'üíó', 'üíì', 'üíû', 'üíò', 'üíù'];
          
          for (let i = 0; i < heartCount; i++) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = heartTypes[Math.floor(Math.random() * heartTypes.length)];
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.top = Math.random() * 100 + 'vh';
            heart.style.animationDelay = Math.random() * 8 + 's';
            heart.style.fontSize = (Math.random() * 1 + 0.8) + 'em';
            heart.style.animationDuration = (15 + Math.random() * 15) + 's';
            container.appendChild(heart);
          }
        }
        
        createRomanticParticle(x, y, emoji) {
          const container = document.getElementById('romanticParticles');
          if (!container) return;
          
          const particle = document.createElement('div');
          particle.className = 'romantic-particle';
          particle.innerHTML = emoji;
          particle.style.left = x + 'px';
          particle.style.top = y + 'px';
          particle.style.fontSize = (Math.random() * 1 + 1) + 'em';
          
          container.appendChild(particle);
          
          setTimeout(() => {
            if (particle.parentNode) {
              particle.parentNode.removeChild(particle);
            }
          }, 3000);
        }
        
        createTouchGlow(x, y) {
          const glow = document.createElement('div');
          glow.className = 'touch-glow';
          glow.style.left = x + 'px';
          glow.style.top = y + 'px';
          
          document.body.appendChild(glow);
          
          setTimeout(() => {
            if (glow.parentNode) {
              glow.parentNode.removeChild(glow);
            }
          }, 600);
        }
        
        initializeEventListeners() {
          console.log('Initializing event listeners...');
          
          // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
          document.getElementById('playBtn').addEventListener('click', () => {
            console.log('Play button clicked');
            this.startGame();
          });
          
          document.getElementById('settingsBtn').addEventListener('click', () => {
            this.showScreen('settings');
          });
          
          document.getElementById('aboutBtn').addEventListener('click', () => {
            this.showScreen('about');
          });
          
          // –ö–Ω–æ–ø–∫–∞ –¥–æ–º–æ–π –≤ –∏–≥—Ä–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ
          document.getElementById('homeBtn').addEventListener('click', () => {
            this.showScreen('mainMenu');
          });
          
          // –ö–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
          document.getElementById('backBtn').addEventListener('click', () => {
            this.showScreen('mainMenu');
          });
          
          document.getElementById('backFromSettingsBtn').addEventListener('click', () => {
            this.showScreen('mainMenu');
          });
          
          document.getElementById('backFromAboutBtn').addEventListener('click', () => {
            this.showScreen('mainMenu');
          });
          
          // –ö–Ω–æ–ø–∫–∏ —ç–∫—Ä–∞–Ω–∞ –ø–æ–±–µ–¥—ã
          document.getElementById('playAgainBtn').addEventListener('click', () => {
            this.hideVictoryScreen();
            this.startGame();
          });
          
          document.getElementById('closeWebAppBtn').addEventListener('click', () => {
            if (isTelegram && tg) {
              tg.close();
            } else {
              this.showScreen('mainMenu');
            }
          });
          
          // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
          document.getElementById('saveSettingsBtn').addEventListener('click', () => {
            this.showScreen('mainMenu');
          });
          
          // –ò–≥—Ä–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏
          document.getElementById('resetBtn').addEventListener('click', () => this.resetGame());
          document.getElementById('nextLevelBtn').addEventListener('click', () => this.nextLevel());
          
          document.getElementById('bonus-destroy').addEventListener('click', () => this.activateBonus('destroy'));
          document.getElementById('bonus-shuffle').addEventListener('click', () => this.activateBonus('shuffle'));
          document.getElementById('bonus-explosion').addEventListener('click', () => this.activateBonus('explosion'));
          
          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–≤–∞–π–ø–æ–≤
          this.initializeSwipeHandling();
          
          console.log('Event listeners initialized');
        }
        
        initializeSwipeHandling() {
          const grid = document.getElementById('grid');
          if (!grid) return;
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π
          grid.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (this.gameState !== 'playing') return;
            
            const touch = e.touches[0];
            const cell = this.getCellFromPoint(touch.clientX, touch.clientY);
            
            if (cell) {
              this.isDragging = true;
              this.lastTouchPos = { x: touch.clientX, y: touch.clientY };
              this.handleCellStart(e, cell.x, cell.y);
              this.createTouchGlow(touch.clientX, touch.clientY);
            }
          }, { passive: false });
          
          grid.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!this.isDragging) return;
            
            const touch = e.touches[0];
            this.lastTouchPos = { x: touch.clientX, y: touch.clientY };
            
            const cell = this.getCellFromPoint(touch.clientX, touch.clientY);
            if (cell && !this.selected.some(sel => sel.x === cell.x && sel.y === cell.y)) {
              this.handleCellHover(cell.x, cell.y);
            }
            
            this.createRomanticParticle(touch.clientX, touch.clientY, 'üíñ');
            
          }, { passive: false });
          
          grid.addEventListener('touchend', (e) => {
            if (this.isDragging) {
              this.handleEnd();
              this.isDragging = false;
              this.lastTouchPos = null;
            }
          });
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º—ã—à–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
          grid.addEventListener('mousedown', (e) => {
            if (this.gameState !== 'playing') return;
            
            const cell = this.getCellFromPoint(e.clientX, e.clientY);
            if (cell) {
              this.isDragging = true;
              this.handleCellStart(e, cell.x, cell.y);
              this.createTouchGlow(e.clientX, e.clientY);
            }
          });
          
          grid.addEventListener('mousemove', (e) => {
            if (!this.isDragging) return;
            
            const cell = this.getCellFromPoint(e.clientX, e.clientY);
            if (cell && !this.selected.some(sel => sel.x === cell.x && sel.y === cell.y)) {
              this.handleCellHover(cell.x, cell.y);
            }
          });
          
          grid.addEventListener('mouseup', () => {
            if (this.isDragging) {
              this.handleEnd();
              this.isDragging = false;
            }
          });
        }
        
        getCellFromPoint(clientX, clientY) {
          const grid = document.getElementById('grid');
          if (!grid) return null;
          
          const rect = grid.getBoundingClientRect();
          const x = clientX - rect.left;
          const y = clientY - rect.top;
          
          const cellWidth = rect.width / this.GRID_W;
          const cellHeight = rect.height / this.GRID_H;
          
          const cellX = Math.floor(x / cellWidth);
          const cellY = Math.floor(y / cellHeight);
          
          if (cellX >= 0 && cellX < this.GRID_W && cellY >= 0 && cellY < this.GRID_H) {
            return { x: cellX, y: cellY };
          }
          
          return null;
        }
        
        showScreen(screenName) {
          try {
            document.querySelectorAll('.screen').forEach(screen => {
              screen.classList.add('hidden');
            });
            
            const targetScreen = document.getElementById(screenName + 'Screen');
            if (targetScreen) {
              targetScreen.classList.remove('hidden');
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —ç–∫—Ä–∞–Ω–∞:", error);
          }
        }
        
        showVictoryScreen() {
          try {
            const victoryOverlay = document.getElementById('victoryOverlay');
            const victoryMessage = document.getElementById('victoryMessage');
            
            if (victoryOverlay && victoryMessage) {
              victoryMessage.textContent = `–¢–∏ –ø—Ä–æ–π—à–ª–∞ –≤—Å—ñ ${this.MAX_LEVEL} —Ä—ñ–≤–Ω—ñ–≤! –¢–∏ –Ω–∞–π–∫—Ä–∞—â–∞ –¥—Ä—É–∂–∏–Ω–∞ —É —Å–≤—ñ—Ç—ñ! üíù`;
              victoryOverlay.classList.remove('hidden');
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —ç–∫—Ä–∞–Ω–∞ –ø–æ–±–µ–¥—ã:", error);
          }
        }
        
        hideVictoryScreen() {
          try {
            const victoryOverlay = document.getElementById('victoryOverlay');
            if (victoryOverlay) {
              victoryOverlay.classList.add('hidden');
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ —Å–∫—Ä—ã—Ç–∏—è —ç–∫—Ä–∞–Ω–∞ –ø–æ–±–µ–¥—ã:", error);
          }
        }
        
        startGame() {
          try {
            console.log('Starting game...');
            this.initGame(0);
            this.showScreen('game');
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã:", error);
          }
        }
        
        initGame(levelNum = 0) {
          try {
            this.currentLevel = levelNum;
            const level = this.levels[this.currentLevel];
            
            this.xp = 0;
            this.xpToNext = level.xpToNext;
            this.maxNumber = level.max;
            this.selected = [];
            this.isDragging = false;
            this.chainNumbers = [];
            this.grid = [];
            this.activeBonus = null;
            this.gameState = 'playing';
            this.messageCount = 0;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏
            for (let x = 0; x < this.GRID_W; x++) {
              this.grid[x] = [];
              for (let y = 0; y < this.GRID_H; y++) {
                this.grid[x][y] = { 
                  number: level.numbers[Math.floor(Math.random() * level.numbers.length)], 
                  merged: false 
                };
              }
            }
            
            this.render();
            this.updateInfo();
            this.showLoveMessage("–û–±'—î–¥–Ω—É–π —á–∏—Å–ª–∞ —Ç–∞ –æ—Ç—Ä–∏–º—É–π –ª—é–±–æ–≤–Ω—ñ —Ñ—Ä–∞–∑–∏! üíï");
            this.updateBonusButtons();
            this.showLevelSelect();
            
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã:", error);
          }
        }
        
        render() {
          try {
            const gridDiv = document.getElementById('grid');
            if (!gridDiv) return;
            
            gridDiv.innerHTML = '';
            
            for (let y = 0; y < this.GRID_H; y++) {
              for (let x = 0; x < this.GRID_W; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.x = x;
                cell.dataset.y = y;
                cell.dataset.number = this.grid[x][y].number;
                
                if (this.selected.some(sel => sel.x === x && sel.y === y)) {
                  cell.classList.add('selected');
                }
                
                if (this.grid[x][y].merged) {
                  cell.classList.add('merged');
                }
                
                const inner = document.createElement('div');
                inner.className = 'cell-inner';
                inner.textContent = this.formatNumber(this.grid[x][y].number);
                cell.appendChild(inner);
                
                gridDiv.appendChild(cell);
              }
            }
            
            this.updateXPBar();
            
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:", error);
          }
        }
        
        handleCellStart(e, x, y) {
          try {
            if (this.gameState !== 'playing') return;
            
            if (this.activeBonus === 'destroy') {
              this.useDestroyBonus(x, y);
              return;
            }
            
            if (this.activeBonus === 'explosion') {
              this.useExplosionBonus(x, y);
              return;
            }
            
            this.selected = [{x, y}];
            this.chainNumbers = [this.grid[x][y].number];
            this.render();
            
            this.createRomanticParticle(
              e.clientX || (e.touches && e.touches[0].clientX), 
              e.clientY || (e.touches && e.touches[0].clientY), 
              'üíï'
            );
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞—á–∞–ª–∞ –≤—ã–±–æ—Ä–∞:", error);
          }
        }
        
        handleCellHover(x, y) {
          if (!this.isDragging || this.activeBonus) return;
          
          try {
            const last = this.selected[this.selected.length - 1];
            if (!this.isAdjacent(last, {x, y})) return;
            
            const newNum = this.grid[x][y].number;
            const prevNum = this.chainNumbers[this.chainNumbers.length - 1];
            if (newNum === prevNum || newNum === prevNum * 2 || prevNum === newNum * 2) {
              this.selected.push({x, y});
              this.chainNumbers.push(newNum);
              this.render();
              
              if (this.lastTouchPos) {
                this.createRomanticParticle(this.lastTouchPos.x, this.lastTouchPos.y, 'üå∏');
              }
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —è—á–µ–π–∫—É:", error);
          }
        }
        
        handleEnd() {
          if (!this.isDragging) return;
          
          try {
            if (this.selected.length >= 2) {
              this.mergeChain();
            } else {
              this.selected = [];
              this.chainNumbers = [];
              this.render();
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞:", error);
          }
        }
        
        isAdjacent(a, b) {
          return Math.abs(a.x - b.x) <= 1 && Math.abs(a.y - b.y) <= 1;
        }
        
        mergeChain() {
          try {
            const last = this.selected[this.selected.length - 1];
            const newValue = this.chainNumbers.reduce((sum, val) => sum + val, 0);
            
            if (!this.isValidResultNumber(newValue)) {
              this.showLoveMessage("–°–ø—Ä–æ–±—É–π —ñ–Ω—à—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é, –∫–æ—Ö–∞–Ω–∞! üíï");
              this.selected = [];
              this.chainNumbers = [];
              this.render();
              return;
            }
            
            this.grid[last.x][last.y].number = newValue;
            this.grid[last.x][last.y].merged = true;
            
            for (let i = 0; i < this.selected.length - 1; i++) {
              const {x, y} = this.selected[i];
              this.grid[x][y].number = this.getRandomInitialNumber();
              this.grid[x][y].merged = false;
            }
            
            const xpEarned = this.calculateXP(this.selected.length);
            this.xp += xpEarned;
            
            this.showRandomLoveMessage(this.selected.length);
            
            if (newValue > this.maxNumber) {
              this.maxNumber = newValue;
            }
            
            setTimeout(() => {
              for (let x = 0; x < this.GRID_W; x++) {
                for (let y = 0; y < this.GRID_H; y++) {
                  this.grid[x][y].merged = false;
                }
              }
              
              this.render();
              this.checkWin();
            }, 350);
            
            this.selected = [];
            this.chainNumbers = [];
            this.render();
            this.updateInfo();
            this.updateBonusButtons();
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏:", error);
          }
        }
        
        showRandomLoveMessage(chainLength) {
          try {
            this.messageCount++;
            document.getElementById('messageCount').textContent = this.messageCount;
            
            let message;
            if (chainLength >= 6) {
              message = "–í–∞—É! –¢–∏ –≥–µ–Ω—ñ–π –∫–æ—Ö–∞–Ω–Ω—è! üíñ –ù–∞—à–∞ –ª—é–±–æ–≤ —Ç–∞–∫–∞ –∂ —Å–∏–ª—å–Ω–∞!";
              for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                  this.createRomanticParticle(
                    Math.random() * window.innerWidth,
                    Math.random() * window.innerHeight,
                    'üíù'
                  );
                }, i * 100);
              }
            } else if (chainLength >= 4) {
              message = "–ß—É–¥–æ–≤–æ! –ù–∞—à–∞ –ª—é–±–æ–≤ —Ä–æ—Å—Ç–µ —è–∫ —Ç–≤–æ—ó –Ω–∞–≤–∏—á–∫–∏! üåü";
            } else {
              const randomIndex = Math.floor(Math.random() * this.loveMessages.length);
              message = this.loveMessages[randomIndex];
            }
            
            this.showLoveMessage(message);
            this.createHeartsAnimation();
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
          }
        }
        
        showLoveMessage(text) {
          try {
            const messageEl = document.getElementById('messageText');
            if (messageEl) {
              messageEl.textContent = text;
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –ª—é–±–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
          }
        }
        
        createHeartsAnimation() {
          try {
            const heartsContainer = document.getElementById('hearts');
            if (!heartsContainer) return;
            
            heartsContainer.innerHTML = '';
            const heartCount = 5;
            
            for (let i = 0; i < heartCount; i++) {
              const heart = document.createElement('div');
              heart.className = 'heart';
              heart.innerHTML = '‚ù§Ô∏è';
              heart.style.left = Math.random() * 80 + 10 + '%';
              heart.style.animationDelay = Math.random() * 0.5 + 's';
              heartsContainer.appendChild(heart);
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–µ—Ä–¥–µ—Ü:", error);
          }
        }
        
        formatNumber(num) {
          if (num >= 1_000_000_000) return (num/1_000_000_000).toFixed(num % 1_000_000_000 === 0 ? 0 : 1) + "B";
          if (num >= 1_000_000) return (num/1_000_000).toFixed(num % 1_000_000 === 0 ? 0 : 1) + "M";
          if (num >= 10_000) return (num/1_000).toFixed(0) + "–ö";
          if (num >= 1_000) return (num/1_000).toFixed(num % 1_000 === 0 ? 0 : 1) + "–ö";
          return num.toString();
        }
        
        isValidResultNumber(num) {
          const level = this.levels[this.currentLevel];
          return level.numbers.includes(num) || level.newNumbers.includes(num);
        }
        
        getRandomInitialNumber() {
          const level = this.levels[this.currentLevel];
          return level.numbers[Math.floor(Math.random() * level.numbers.length)];
        }
        
        calculateXP(chainLen) {
          if (chainLen === 2) return 1;
          if (chainLen === 3) return 4;
          if (chainLen === 4) return 8;
          if (chainLen === 5) return 15;
          if (chainLen >= 6) return 25;
          return 0;
        }
        
        updateXPBar() {
          try {
            const xpBar = document.getElementById('xpBar');
            const xpText = document.getElementById('xpText');
            
            if (xpBar && xpText) {
              const percent = Math.min(1, this.xp / this.xpToNext);
              xpBar.style.width = (percent * 100) + '%';
              xpText.textContent = `${this.xp}/${this.xpToNext}`;
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è XP –±–∞—Ä–∞:", error);
          }
        }
        
        updateInfo() {
          try {
            const level = this.levels[this.currentLevel];
            const currentLevelEl = document.getElementById('currentLevel');
            const targetValueEl = document.getElementById('targetValue');
            
            if (currentLevelEl) {
              currentLevelEl.textContent = this.currentLevel + 1;
            }
            if (targetValueEl) {
              targetValueEl.textContent = this.formatNumber(level.target);
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:", error);
          }
        }
        
        activateBonus(bonusType) {
          try {
            if (this.activeBonus === bonusType) {
              this.activeBonus = null;
              this.updateBonusButtons();
              this.render();
              return;
            }
            
            if (this.xp < this.bonusCosts[bonusType]) {
              this.showLoveMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ—á–∫—ñ–≤ –∫–æ—Ö–∞–Ω–Ω—è! ‚ù§Ô∏è‚Äçüî•");
              return;
            }
            
            if (bonusType === 'shuffle') {
              this.xp -= this.bonusCosts.shuffle;
              this.shuffleGrid();
              this.showLoveMessage("–ü–æ–ª–µ –ø–µ—Ä–µ–º—ñ—à–∞–Ω–æ –∑ –ª—é–±–æ–≤'—é! üí´");
              this.updateBonusButtons();
              return;
            }
            
            this.activeBonus = bonusType;
            this.updateBonusButtons();
            this.render();
            this.showLoveMessage("–ë–æ–Ω—É—Å –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ! üí´");
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –±–æ–Ω—É—Å–∞:", error);
          }
        }
        
        shuffleGrid() {
          try {
            const all = [];
            for (let x = 0; x < this.GRID_W; x++) {
              for (let y = 0; y < this.GRID_H; y++) {
                all.push(this.grid[x][y].number);
              }
            }
            
            for (let i = all.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [all[i], all[j]] = [all[j], all[i]];
            }
            
            let k = 0;
            for (let x = 0; x < this.GRID_W; x++) {
              for (let y = 0; y < this.GRID_H; y++) {
                this.grid[x][y].number = all[k++];
              }
            }
            
            this.render();
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è —Å–µ—Ç–∫–∏:", error);
          }
        }
        
        useDestroyBonus(x, y) {
          try {
            this.grid[x][y].number = this.getRandomInitialNumber();
            this.xp -= this.bonusCosts.destroy;
            this.activeBonus = null;
            this.updateBonusButtons();
            this.render();
            this.updateInfo();
            this.showLoveMessage("–ö–ª—ñ—Ç–∏–Ω–∫—É —Ä–æ–∑–±–∏—Ç–æ –∑ –ª—é–±–æ–≤'—é! üíñ");
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ–Ω—É—Å–∞ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è:", error);
          }
        }
        
        useExplosionBonus(x, y) {
          try {
            for (let dx = -1; dx <= 1; dx++) {
              for (let dy = -1; dy <= 1; dy++) {
                const nx = x + dx;
                const ny = y + dy;
                
                if (nx >= 0 && nx < this.GRID_W && ny >= 0 && ny < this.GRID_H) {
                  this.grid[nx][ny].number = this.getRandomInitialNumber();
                }
              }
            }
            
            this.xp -= this.bonusCosts.explosion;
            this.activeBonus = null;
            this.updateBonusButtons();
            this.render();
            this.updateInfo();
            this.showLoveMessage("–í–∏–±—É—Ö –∫–æ—Ö–∞–Ω–Ω—è! üí•‚ù§Ô∏è");
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ–Ω—É—Å–∞ –≤–∑—Ä—ã–≤–∞:", error);
          }
        }
        
        updateBonusButtons() {
          try {
            const bonuses = ['destroy', 'shuffle', 'explosion'];
            
            bonuses.forEach(bonus => {
              const btn = document.getElementById(`bonus-${bonus}`);
              if (!btn) return;
              
              const cost = this.bonusCosts[bonus];
              
              if (this.activeBonus === bonus) {
                btn.classList.add('active');
              } else {
                btn.classList.remove('active');
              }
              
              if (this.xp < cost && this.activeBonus !== bonus) {
                btn.disabled = true;
              } else {
                btn.disabled = false;
              }
            });
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –±–æ–Ω—É—Å–æ–≤:", error);
          }
        }
        
        showLevelSelect() {
          try {
            const sel = document.getElementById('level-select');
            if (!sel) return;
            
            sel.innerHTML = "";
            
            for (let i = 0; i < this.levels.length; i++) {
              const btn = document.createElement('button');
              btn.className = "level-btn";
              btn.textContent = i + 1;
              
              if (i === this.currentLevel) {
                btn.classList.add("selected");
              }
              
              btn.addEventListener('click', () => {
                this.currentLevel = i;
                this.initGame(i);
              });
              
              sel.appendChild(btn);
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è:", error);
          }
        }
        
        checkWin() {
          try {
            const level = this.levels[this.currentLevel];
            
            for (let x = 0; x < this.GRID_W; x++) {
              for (let y = 0; y < this.GRID_H; y++) {
                if (this.grid[x][y].number === level.target) {
                  this.gameState = 'win';
                  this.showLoveMessage(`–í—ñ—Ç–∞—é! –¢–∏ –¥–æ—Å—è–≥–ª–∞ —Ü—ñ–ª—ñ ${this.formatNumber(level.target)}! üéâ‚ù§Ô∏è`);
                  this.autoNextLevel();
                  return;
                }
              }
            }
            
            if (this.xp >= this.xpToNext) {
              this.showLoveMessage("–¢–∏ –≥–æ—Ç–æ–≤–∞ –¥–æ –Ω–æ–≤–æ–≥–æ —Ä—ñ–≤–Ω—è –∫–æ—Ö–∞–Ω–Ω—è! üíñ");
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–±–µ–¥—ã:", error);
          }
        }
        
        autoNextLevel() {
          try {
            if (this.currentLevel < this.MAX_LEVEL - 1) {
              setTimeout(() => {
                this.showLoveMessage(`–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Ä—ñ–≤–µ–Ω—å ${this.currentLevel + 2} —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏... ‚è±Ô∏è`);
                setTimeout(() => {
                  this.initGame(this.currentLevel + 1);
                  this.showLoveMessage(`–†—ñ–≤–µ–Ω—å ${this.currentLevel + 1}! –ù–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ! üöÄ`);
                }, 3000);
              }, 2000);
            } else {
              setTimeout(() => {
                this.showVictoryScreen();
              }, 2000);
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å:", error);
          }
        }
        
        nextLevel() {
          try {
            if (this.currentLevel < this.MAX_LEVEL - 1) {
              if (this.xp >= this.xpToNext) {
                this.initGame(this.currentLevel + 1);
                this.showLoveMessage(`–†—ñ–≤–µ–Ω—å ${this.currentLevel + 1}! –ù–æ–≤—ñ –≤–∏–∫–ª–∏–∫–∏! üåü`);
              } else {
                this.showLoveMessage(`–ü–æ—Ç—Ä—ñ–±–Ω–æ ${this.xpToNext} –æ—á–∫—ñ–≤ –∫–æ—Ö–∞–Ω–Ω—è! ‚ù§Ô∏è`);
              }
            } else {
              this.showVictoryScreen();
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å:", error);
          }
        }
        
        resetGame() {
          try {
            this.initGame(this.currentLevel);
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –∏–≥—Ä—ã:", error);
          }
        }
        
        generateLevels(count) {
          const levels = [];
          let target = 64;
          let baseNumbers = [2, 4, 8];
          
          for (let i = 0; i < count; i++) {
            const level = {
              numbers: [...baseNumbers],
              target: target,
              newNumbers: this.generateNewNumbers(target),
              max: baseNumbers[baseNumbers.length - 1],
              xpToNext: 10 + Math.floor(i * 2.5)
            };
            
            levels.push(level);
            
            target *= 2;
            
            if (i % 3 === 2 && baseNumbers.length < 5) {
              baseNumbers.push(baseNumbers[baseNumbers.length - 1] * 2);
            }
            
            if (i >= 15 && baseNumbers.length < 6) {
              baseNumbers.push(baseNumbers[baseNumbers.length - 1] * 2);
            }
          }
          
          return levels;
        }
        
        generateNewNumbers(target) {
          const newNumbers = [];
          let num = target / 8;
          for (let i = 0; i < 8; i++) {
            if (num <= target) {
              newNumbers.push(num);
              num *= 2;
            }
          }
          return newNumbers;
        }
      }
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
      console.log('Creating game instance...');
      window.game = new LoveNumberPuzzle();
      console.log('Game instance created successfully');
    });
  </script>
</body>
</html>